{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\home\\controller\\user.js"
    ],
    "names": [
        "mgr",
        "errorCode",
        "http",
        "require",
        "indexAction",
        "action",
        "get",
        "console",
        "log",
        "assign",
        "display",
        "loginAction",
        "isGet",
        "post",
        "username",
        "password",
        "cookie",
        "login",
        "then",
        "result",
        "setUser",
        "error",
        "pm",
        "getUser",
        "userId",
        "pm1",
        "user",
        "phone",
        "email",
        "name",
        "userRoles",
        "redirect",
        "registerAction",
        "userinfor",
        "realName",
        "phoneNum",
        "code",
        "verificationCode",
        "createUser",
        "pmc",
        "registerphoneAction",
        "phoneTest",
        "userList",
        "sendShortMsgCode",
        "passwordAction",
        "infor",
        "updatePassword",
        "passwordsendmsgAction",
        "testAction",
        "phone1",
        "passwordcodeAction",
        "userlistAction",
        "getUserList",
        "j",
        "elm",
        "loginverificatAction",
        "password1",
        "secToken",
        "tod",
        "Date",
        "toString",
        "toDateString",
        "sendshortmsgcodeAction",
        "verificationcodeAction"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\home\\controller\\user.js",
    "sourcesContent": [
        "'use strict';\r\n\r\nimport Base from './base.js';\r\nimport UserMgr from '../connect/usermgr.js';\r\n\r\nvar mgr = new UserMgr();\r\nvar errorCode = 0;\r\n\r\nvar http = require('http');\r\n\r\nexport default class extends Base {\r\n\r\n    indexAction() {\r\n        let action = this.get('action');\r\n        console.log(action);\r\n        \r\n        this.assign('action', action);\r\n        return this.display();\r\n    }\r\n\r\n    //user login method \r\n   async loginAction(){\r\n\r\n\r\n          \r\n\r\n\r\n           if(this.isGet()){\r\n                    return this.display();\r\n             }\r\n             console.log(\"=======loginAction start=======\");\r\n          console.log(\"[loginAction] \" + this.post());\r\n          \r\n          console.log(this.post().username+\"|\"+this.post().password);\r\n          this.cookie(\"username\", this.post().username);\r\n          if(this.post().username==null || this.post().username==''){\r\n              console.log(\"test loginAction\");\r\n              return this.display();\r\n          }\r\n          else{\r\n        \t  let pm = await mgr.login(this.post().username,this.post().password)\r\n        \t  \t.then(function(result){\r\n              console.log(result);\r\n              UserMgr.setUser(result);\r\n              console.log(\"-------------------\");\r\n\r\n              if(result.errorCode==0){\r\n                errorCode=result.errorCode;\r\n                console.log(errorCode);\r\n                  return result;\r\n              }else{\r\n                errorCode=result.errorCode;\r\n                return result;\r\n              }\r\n              //get user information method\r\n          },\r\n          function(error){\r\n              console.log(error);\r\n          })\r\n\r\n          /*console.log(\"=========get getuser params===========\");\r\n              console.log(pm);\r\n             let pm1 = await mgr.getUser(1,pm.userId)\r\n              .then(function(result){\r\n                  return result;\r\n              })\r\n              console.log(\"---------cookie params--------\");\r\n              console.log(pm1);\r\n              this.cookie(\"phone\", pm1.user.phone);\r\n              this.cookie(\"email\", pm1.user.email);*/\r\n\r\n          if(errorCode==0){\r\n            this.assign(\"pm\",pm);\r\n            console.log(pm);\r\n            console.log(\"=========get getuser params===========\");\r\n              console.log(pm);\r\n             let pm1 = await mgr.getUser(\"\"+pm.userId, pm.userId)\r\n              .then(function(result){\r\n                  return result;\r\n              })\r\n              console.log(\"---------cookie params--------\");\r\n              console.log(pm1);\r\n              \r\n              this.cookie(\"phone\", pm1.user.phone);\r\n              this.cookie(\"email\", pm1.user.email);\r\n              this.cookie(\"name\",pm1.user.name);\r\n              this.cookie('userId', pm.userId);\r\n              this.cookie('role',pm1.user.userRoles);\r\n           // return this.display('home:index:index');\r\n           // return this.redirect('/user/userlist');\r\n\r\n\t           if(pm1.user.userRoles=='admin'){\r\n\t        \t   return this.redirect('/back/userlist');\r\n\t           }else{\r\n\t        \t   return this.redirect('/index/index');\r\n\t           }\r\n          }\r\n          else{\r\n            this.assign(\"pm\",pm);\r\n            console.log(\"======login fail==========\");\r\n            if(pm.errorCode==1002){\r\n              this.assign(\"loginmsg\",\"用户名不存在\");\r\n            }else if(pm.errorCode==1001){\r\n              this.assign(\"loginmsg\",\"用户名密码错误\");                \r\n            }else{\r\n              this.assign(\"loginmsg\",\"其他错误请稍后再试。。。。。\");  \r\n            }\r\n            console.log(pm);\r\n             return this.display();\r\n          }\r\n          \r\n        }\r\n\r\n    \r\n      \r\n    }\r\n\r\n\r\n    //register method  \r\n   async registerAction(){\r\n\r\n      if(this.isGet()){\r\n                    return this.display();\r\n             }\r\n      //user infor params\r\n      //try{\r\n\r\n      let userinfor=this.post();\r\n      console.log(userinfor);\r\n      console.log(\"====================\");\r\n      let username =this.post('username');\r\n      let password =this.post('password');\r\n      let realName =this.post('realName');\r\n      let email =this.post('email');\r\n      console.log(username+\"|||\"+email);\r\n\r\n      //verification params\r\n     let phoneNum =this.post('phoneNum');\r\n    let code  =this.post('code');\r\n\r\n    \r\n    if(code==null||code==\"\"){\r\n            return this.display();\r\n        }else{\r\n          console.log(\"----------verificationcodeAction start -----------\");\r\n          let pm = await mgr.verificationCode(phoneNum,code)\r\n          .then(function(result){\r\n                console.log(result);\r\n                //this.assign(\"result\",result);\r\n                return result;\r\n         \r\n              })\r\n\r\n              if(pm.errorCode==0){\r\n                  console.log(\"----------createUser start -----------\");\r\n                  let pmc = await mgr.createUser(username,password,realName,email,phoneNum)\r\n                  .then(function(result){\r\n                   // console.log(result);\r\n                    return result;\r\n                  })\r\n                  console.log(\"--------------------------\");\r\n                  console.log(pmc);\r\n                  console.log(typeof pmc);\r\n                  this.assign(\"pm1\",pmc);\r\n                  if(pmc.errorCode==1104){\r\n                     this.error(\"msg\",\"用户名已被注册,请返回\");\r\n               }else{\r\n                  return this.display(\"home:user:login\");\r\n               }\r\n                  \r\n               }\r\n               \r\n                  \r\n               \r\n              else{\r\n                      this.assign(\"userinfor\",userinfor);\r\n                      this.assign(\"msg\",\"验证码输入错误\");\r\n                      return this.display();\r\n              }\r\n         }\r\n        //createUser method \r\n\r\n    /*  }catch(e){\r\n\r\n        console.log(\"注册失败\");\r\n\r\n        this.assign(\"userinfor\",userinfor);\r\n        this.assign(\"msg\",\"用户名已经被注册\");\r\n         return this.display();\r\n\r\n      }*/\r\n     \r\n        \r\n        \r\n        \r\n        \r\n      \r\n      //\r\n   } \r\n\r\n\r\n\r\n   async registerphoneAction(){\r\n\r\n    console.log(\"======registerphoneAction start==============\");\r\n    let userinfor = this.post();\r\n    console.log(userinfor);\r\n    this.assign(\"userinfor\",userinfor);\r\n\r\n    console.log(userinfor.phoneNum);\r\n    try{\r\n      let pm = await mgr.phoneTest(userinfor.phoneNum)\r\n               .then(function(result){\r\n                console.log(result);\r\n                //this.assign(\"result\",result);\r\n                return result;\r\n         \r\n              })\r\n\r\n      console.log(pm);\r\n\r\n                if(pm.userList!=null){\r\n                   \r\n                      //this.assign(\"phone\",phone.phone1);\r\n                      //this.assign(\"username\",pm.userList[0].name);\r\n                      this.assign(\"msg\",\"电话号码已注册\");\r\n                    \r\n                    \r\n                }else{\r\n                  //this.assign(\"phone\",phone.phone1);\r\n                  this.assign(\"msg\",\"电话号码可以注册(手机验证码发到手机5分钟以内不能再获取)\");\r\n                  console.log(\"----------sendShortMsgCodeAction  start-----------\")\r\n                   let pm = await mgr.sendShortMsgCode(0,0, userinfor.phoneNum)\r\n                 .then(function(result){\r\n                   //console.log(result);\r\n                 return result;\r\n                      })\r\n\r\n\r\n                }\r\n\r\n\r\n\r\n    return this.display(\"user:register\")\r\n   // return this.redirect(\"/user/register\");\r\n\r\n   }catch(e){\r\n      return this.display(\"user:register\");\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n   }\r\n   async passwordAction(){\r\n          \r\n          try{\r\n              let infor = this.post();\r\n              console.log(\"-------passwordAction---verificationcodeAction start -----------\");\r\n              console.log(infor);\r\n              let pm = await mgr.updatePassword(infor.username,infor.password,infor.phone,infor.code)\r\n              .then(function(result){\r\n\r\n                console.log(result);\r\n                return result;\r\n\r\n              })\r\n              console.log(pm);\r\n              if(pm.errorCode==0){\r\n                return this.display(\"user:login\");\r\n              }\r\n              return this.display();\r\n          }catch(e){\r\n              return this.display();\r\n          }\r\n         \r\n           \r\n         // this.assign(\"msg\",\"电话号码存在，请注册\");\r\n\r\n\r\n          //console.log(pm.userList[0].phone);\r\n         \r\n          \r\n          \r\n          //this.assign(\"msg\",\"test\");\r\n\r\n\r\n   }\r\n\r\n   // password find send msg\r\n async passwordsendmsgAction()\r\n   {\r\n\r\n      console.log(\"========passwordsendmsgAction=========\");\r\n      let phone = this.post(\"phone\");\r\n\r\n      console.log(phone);\r\n\r\n      let pm = await mgr.sendShortMsgCode(0,0, phone)\r\n    .then(function(result)\r\n    {\r\n        //console.log(result);\r\n        return result;\r\n    })\r\n    console.log(\"-----------------------\");\r\n    console.log(pm);\r\n\r\n\r\n\r\n\r\n     // return this.redirect(\"/user/password\");\r\n      return this.display();\r\n   }\r\n\r\n\r\n   async testAction(){\r\n\r\n    let phone = this.post();\r\n\r\n   // this.assign(\"msg\",phone.phone1);\r\n    console.log(phone);\r\n    try{\r\n      let pm = await mgr.phoneTest(phone.phone1)\r\n               .then(function(result){\r\n                console.log(result);\r\n                //this.assign(\"result\",result);\r\n                return result;\r\n         \r\n              })\r\n\r\n          console.log(pm.userList);\r\n\r\n                if(pm.userList!=null){\r\n                    if(phone==null){\r\n                      this.assign(\"msg\",\"\");\r\n                    }else{\r\n                      this.assign(\"phone\",phone.phone1);\r\n                      this.assign(\"username\",pm.userList.name);\r\n                     // this.assign(\"msg\",\"电话号码存在\");\r\n                    }\r\n                    \r\n                }else{\r\n                  this.assign(\"phone\",phone.phone1);\r\n                  this.assign(\"msg\",\"电话号码不存在\");\r\n                }\r\n                /*if(pm.userList[0].phone!=phone.phone1){\r\n                   console.log(\"success\");\r\n                   //this.assign(\"phone\",infor.phone);\r\n                  // this.assign(\"msg\",\"电话号码存在\");\r\n                   this.assign(\"msg\",\"电话号码不存在，请注册\");\r\n                 }else {\r\n                  this.assign(\"msg\",\"电话号码存在\");\r\n                 // this.assign(\"msg\",\"电话号码不存在，请注册\");\r\n                 }*/\r\n      //return this.redirect(\"/user/password\");\r\n      return this.display(\"user:password\");\r\n\r\n    }catch(e){\r\n      return this.display(\"user:password\");\r\n    }\r\n    \r\n   }\r\n\r\n\r\n   async passwordcodeAction(){\r\n    console.log(\"====passwordcodeAction start===========\");\r\n    let infor = this.post();\r\n    console.log(infor);\r\n    try{\r\n        let pm = await mgr.verificationCode(infor.phone,infor.code)\r\n    .then(function(result){\r\n\r\n        console.log(result);\r\n        return result;\r\n    },function(error){\r\n      console.log(error);\r\n    })\r\n      console.log(pm);\r\n\r\n      if(pm.errorCode==0){\r\n        this.assign(\"msg\",\"验证码正确\");\r\n        this.assign(\"phone\",infor.phone);\r\n        this.assign(\"username\",infor.username);\r\n        this.assign(\"code\",infor.code);\r\n      }else{\r\n        this.assign(\"msg\",\"验证码错误\");\r\n        //this.assign(\"infor\",infor);\r\n        this.assign(\"phone\",infor.phone);\r\n        this.assign(\"code\",infor.code);\r\n      }\r\n\r\n      return this.display(\"user:password\");\r\n    }catch(e){\r\n\r\n    }\r\n\r\n\r\n\r\n   }\r\n\r\n   //获得用户列表的方法\r\n    async userlistAction(){\r\n    \tvar userId = this.cookie('userId');\r\n    \tconsole.log(\"[userlistAction] \" + userId);\r\n      let pm  = await mgr.getUserList(userId, \"\")\r\n    .then( function (result) { \r\n      //process.stdout.write(result);\r\n      //console.log(result.toString()); \r\n      //var ret = JSON.parse(result.toString());\r\n      \r\n      return result;\r\n    },   \r\n    function (error) {   \r\n       console.log(error);   \r\n    });\r\n    \r\n    for(let j in pm.userList){\r\n      var elm = pm.userList[j];\r\n      console.log(elm.userId + \"|\" + elm.name + \"|\" + elm.password); \r\n      this.assign('elm',elm);\r\n      this.assign('userList',pm.userList);\r\n    }\r\n\r\n      return this.display();\r\n   }\r\n   // login verification method \r\n   async loginverificatAction(){\r\n      try {\r\n      let infor = this.get('infor');\r\n      let username = this.get('username');\r\n      let password1 = this.get('password1');\r\n      console.log(username+\"||\"+password1);\r\n      console.log(infor);\r\n      console.log(\"------------------------------------\");\r\n    errorCode = 0;\r\n    //let pm = await mgr.login('root', 'e946b69705089bb7')\r\n    let pm = await mgr.login(username, password1)\r\n    .then( function (result) { \r\n      //process.stdout.write(result);\r\n      if( result.errorCode == 0){\r\n        console.log(result.userId + \"|\" + result.secToken); \r\n        UserMgr.setUser(result);\r\n        //userinfo = result;\r\n        return result;\r\n         \r\n        //console.log(\"ret : \" + userinfo.userId + \"|\" + userinfo.secToken);\r\n      }\r\n      else{\r\n        errorCode = result.errorCode;\r\n        //console.log(\"ret : \" + result.errorCode + \"|\" + result.errorMsg);\r\n      } \r\n    },   \r\n    function (error) { \r\n      errorCode =error.errorCode;\r\n        console.log(error);   \r\n    }); \r\n    \r\n    var tod = new Date();\r\n    console.log(\"today : \" + tod.toString() + \"|\" + tod.toDateString());\r\n    if(errorCode==0){\r\n      //路由跳转\r\n      return this.redirect('/user/userlist');\r\n      //return this.display(\"home:user:userlist\");\r\n    }\r\n    else{\r\n      console.log(pm);\r\n      console.log(\"---------------------\");\r\n      this.assign('user', pm);\r\n      return this.display('home:user:login');\r\n    }\r\n  } \r\n  catch (e) { \r\n    console.log(e); \r\n  }\r\n   }\r\n\r\n\r\n   //send short message to cellphone\r\n   async sendshortmsgcodeAction(){\r\n     let phoneNum =this.get('phoneNum');\r\n    console.log(phoneNum);\r\n    console.log(\"----------sendShortMsgCodeAction  start-----------\")\r\n    let pm = await mgr.sendShortMsgCode(0,0, phoneNum)\r\n    .then(function(result){\r\n        //console.log(result);\r\n        return result;\r\n    })\r\n    console.log(\"-----------------------\");\r\n    console.log(pm)\r\n    return this.display();\r\n\r\n\r\n   }\r\n\r\n\r\n   async verificationcodeAction(){\r\n    let phoneNum =this.get('phoneNum');\r\n    let code  =this.get('code');\r\n    console.log(phoneNum+code);\r\n    console.log(\"----------verificationCode start -----------\")\r\n    let pm = await mgr.verificationCode(phoneNum,code)\r\n    .then(function(result){\r\n\r\n        //console.log(result);\r\n        return result;\r\n    })\r\n    return pm;\r\n    console.log(\"-------\")\r\n   \r\n\r\n\r\n   }\r\n\r\n\r\n   \r\n}"
    ]
}